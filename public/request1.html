<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thammasat University</title>
    <link rel="stylesheet" href="./style/stylerequest1.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=K2D:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800&family=Sarabun:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800&display=swap');
    </style>
</head>
<body>
    <header class="header">
        <img src="./image/Emblem_of_Thammasat_University.svg.png" alt="Thammasat University Logo" class="logo">
        <h1>‡∏°‡∏´‡∏≤‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢‡∏ò‡∏£‡∏£‡∏°‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå<br>THAMMASAT UNIVERSITY</h1>
    </header>
    <div class="container">
        <nav class="sidebar">
            <ul>
                <a href="home.html"><li id="home-nav">‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</li></a>
                <a href="request1.html"><li id="req1-nav">‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏Ñ‡∏≥‡∏£‡πâ‡∏≠‡∏á</li></a>
            </ul>
            <div class="logout-container">
                <li id="logout-nav">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</li>
            </div>
        </nav>
        <div class="main-content">
            <h1>‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏Ñ‡∏≥‡∏£‡πâ‡∏≠‡∏á‡∏Ç‡∏≠‡∏à‡∏î‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏•‡πà‡∏≤‡∏ä‡πâ‡∏≤</h1>
            <form id="requestForm" onsubmit="return validateForm()">
                <div class="form-group">
                    <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label>
                    <input  
                        type="date" 
                        class="date-input"
                        id="date" 
                        placeholder="‡∏ß‡∏ß/‡∏î‡∏î/‡∏õ‡∏õ‡∏õ‡∏õ"
                        required 
                        maxlength="10"
                    >       

                </div>
                <div class="form-group multi-column">
                    <div>
                        <label>‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
                        <input type="text" id="name" required>
                    </div>
                    <div>
                        <label>‡πÄ‡∏•‡∏Ç‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô</label>
                        <input 
                        type="text" 
                        id="id" 
                        placeholder="‡πÄ‡∏•‡∏Ç‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô" 
                        required 
                        maxlength="10"
                        oninput="this.value = this.value.replace(/[^0-9]/g, '')"
                        >
                    </div>
                    <div>
                        <label>‡∏™‡∏≤‡∏Ç‡∏≤</label>
                        <input type="text" id="faculty" required>
                    </div>
                    <div>
                        <label>‡∏ä‡∏±‡πâ‡∏ô‡∏õ‡∏µ</label>
                        <input  
                        type="text" class="p-input"
                        id="year" 
                        placeholder="‡∏ä‡∏±‡πâ‡∏ô‡∏õ‡∏µ" 
                        required 
                        maxlength="1"
                        oninput="this.value = this.value.replace(/[^1-8]/g, '')"
                        
                        >
                    </div>
                </div>
                <div class="form-group multi-column">
                    <div>
                        <label>‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÑ‡∏î‡πâ</label>
                        <input type="text" id="address" required>
                    </div>
                    <div>
                        <label>‡πÅ‡∏Ç‡∏ß‡∏á/‡∏ï‡∏≥‡∏ö‡∏•</label>
                        <input type="text" id="district" required>
                    </div>
                    <div>
                        <label>‡πÄ‡∏Ç‡∏ï/‡∏≠‡∏≥‡πÄ‡∏†‡∏≠</label>
                        <input type="text" id="subdistrict" required>
                    </div>
                    <div>
                        <label>‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î</label>
                        <input type="text" id="province" required>
                    </div>
                </div>
                <div class="form-group multi-column">
                    <div>
                        <label>‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</label>
                        <input 
                        type="text" 
                        id="student-tel" 
                        placeholder="‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤" 
                        required 
                        maxlength="10"
                        oninput="this.value = this.value.replace(/[^0-9]/g, '')"
                        >
                    </div>
                    <div>
                        <label>‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå‡∏ú‡∏π‡πâ‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á</label>
                        <input 
                        type="text" 
                        id="parent-tel" 
                        placeholder="‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå‡∏ú‡∏π‡πâ‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á" 
                        required 
                        maxlength="10"
                        oninput="this.value = this.value.replace(/[^0-9]/g, '')"
                        >
                    </div>
                    <div>
                        <label>‡∏≠‡∏≤‡∏à‡∏≤‡∏£‡∏¢‡πå‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤</label>
                        <input type="text" id="advisor" required>
                    </div>
                </div>
                <div class="textt">
                    <h3>‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå‡∏à‡∏∞‡∏¢‡∏∑‡πà‡∏ô‡∏Ñ‡∏≥‡∏£‡πâ‡∏≠‡∏á‡∏à‡∏î‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏•‡πà‡∏≤‡∏ä‡πâ‡∏≤</h3>
                </div>
                <div class="form-group multi-column">
                    <div>
                        <label>‡∏†‡∏≤‡∏Ñ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏µ‡πà</label>
                        <input type="text" 
                        id="semester"  
                        placeholder="‡πÄ‡∏ä‡πà‡∏ô 1/2566" 
                        required 
                        maxlength="6"
                        pattern="^[0-9]{1}/[0-9]{4}$"
                        >
                    </div>
                    <div>
                        <label>‡∏£‡∏´‡∏±‡∏™‡∏ß‡∏¥‡∏ä‡∏≤</label>
                        <input type="text" id="courseCode" required>
                    </div>
                    <div>
                        <label>‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡∏¥‡∏ä‡∏≤</label>
                        <input type="text" id="courseName" required>
                    </div>
                    <div>
                        <label>section</label>
                        <input type="text" id="section" required>
                    </div>
                </div>
                <div class="form-group">
                    <label>‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏ó‡∏µ‡πà‡∏¢‡∏∑‡πà‡∏ô‡∏Ñ‡∏≥‡∏£‡πâ‡∏≠‡∏á‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏≤‡∏Å</label>
                    <textarea rows="4" id="reason" required></textarea>
                </div>
                <div class="form-group">
                    <label>‡πÅ‡∏ô‡∏ö‡πÑ‡∏ü‡∏•‡πå:</label>
                    <button type="button" class="custom-file-button" onclick="document.getElementById('attachment').click();">Choose Files</button>
                    <input type="file" id="attachment" name="attachments" class="file-input" style="display: none;" multiple>
                    <div id="file-list"></div>
                    
                    <label>‡∏£‡∏ß‡∏°‡πÑ‡∏ü‡∏•‡πå PDF ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÄ‡∏õ‡πá‡∏ô PDF ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô:</label>
                    <button type="button" class="custom-file-button merge-pdf-button">‡∏£‡∏ß‡∏°‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏õ‡πá‡∏ô PDF</button><br><br><br>

                    <button type="button" class="custom-file-button submit" id = "submitButton">‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏£‡πâ‡∏≠‡∏á</button>
                </div>
                <div id="myModal" class="modal">
                    <div class="modal-content">
                        <p>‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏£‡πâ‡∏≠‡∏á<br>‡∏Ç‡∏≠‡∏à‡∏î‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏•‡πà‡∏≤‡∏ä‡πâ‡∏≤</p><br>
                        <button id="confirmBtn" class="button confirm-btn">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</button>
                        <button id="cancelBtn" class="button cancel-btn">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <script src="./js/request1.js"></script>
    <script src="./js/sessionUtils.js"></script>
    <script src="./js/logout.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js"></script>
    

    <script>
      document.addEventListener('DOMContentLoaded', function() {
    const attachmentInput = document.getElementById('attachment');
    const fileListContainer = document.getElementById('file-list');
    const dt = new DataTransfer();

    attachmentInput.addEventListener('change', function() {
        if (dt.items.length + this.files.length > 5) {
            alert("‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏ô‡∏ö‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏î‡πâ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 5 ‡πÑ‡∏ü‡∏•‡πå");
            return;
        }

        const files = Array.from(this.files);
        files.forEach(file => {
            if ((file.type === "application/pdf" || file.type.startsWith('image/')) && file.size > 302400) {
                alert("‡πÑ‡∏ü‡∏•‡πå PDF ‡πÅ‡∏•‡∏∞‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 300 KB");
                return;
            }
            dt.items.add(file);
            addFileItem(file);
        });

        attachmentInput.files = dt.files;
    });

    function addFileItem(file) {
        const fileItem = document.createElement('div');
        fileItem.classList.add('file-item');

        const fileLink = document.createElement('a');
        fileLink.href = URL.createObjectURL(file);
        fileLink.download = file.name;
        fileLink.classList.add('file-name');
        fileLink.target = '_blank';
        fileLink.textContent = file.type === "application/pdf" ? 'üìÑ ' : (file.type.startsWith('image/') ? 'üñºÔ∏è ' : 'üìÑ ');
        fileLink.appendChild(document.createTextNode(` ${file.name} (${(file.size / 1024).toFixed(2)} KB)`));

        fileItem.appendChild(fileLink);

        const renameButton = createRenameButton(file, fileLink);
        fileItem.appendChild(renameButton);

        const removeButton = createRemoveButton(file, fileItem);
        fileItem.appendChild(removeButton);

        fileListContainer.appendChild(fileItem);
    }

    function createRenameButton(file, fileLink) {
        const button = document.createElement('button');
        button.textContent = "‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠";
        button.classList.add('rename-file-button');
        button.onclick = () => {
            const newName = prompt("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡∏°‡πà:", file.name);
            if (newName && newName !== file.name) {
                const updatedFile = new File([file], newName, { type: file.type });
                dt.items.remove(Array.from(dt.files).indexOf(file));
                dt.items.add(updatedFile);
                attachmentInput.files = dt.files;
                fileLink.href = URL.createObjectURL(updatedFile);
                fileLink.download = newName; // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î
                fileLink.textContent = `${fileLink.textContent.split(' ')[0]} ${newName} (${(updatedFile.size / 1024).toFixed(2)} KB)`; // ‡πÅ‡∏™‡∏î‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡∏°‡πà‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏Å‡πà‡∏≤
            }
        };
        return button;
    }

    function createRemoveButton(file, fileItem) {
        const button = document.createElement('button');
        button.innerHTML = "&#10006;";
        button.classList.add('remove-file-button');
        button.onclick = () => {
            dt.items.remove(Array.from(dt.files).indexOf(file));
            attachmentInput.files = dt.files;
            fileItem.remove();
        };
        return button;
    }

    document.querySelector('.merge-pdf-button').addEventListener('click', async function() {
        const pdfFiles = Array.from(dt.files).filter(file => file.type === "application/pdf");
        if (pdfFiles.length === 0) {
            alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå PDF ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏£‡∏ß‡∏°");
            return;
        }

        const { PDFDocument } = PDFLib;
        const mergedPdf = await PDFDocument.create();
        for (const file of pdfFiles) {
            const arrayBuffer = await file.arrayBuffer();
            const pdf = await PDFDocument.load(arrayBuffer);
            const copiedPages = await mergedPdf.copyPages(pdf, pdf.getPageIndices());
            copiedPages.forEach(page => mergedPdf.addPage(page));
        }

        const pdfBytes = await mergedPdf.save();
        const blob = new Blob([pdfBytes], { type: "application/pdf" });
        const mergedFile = new File([blob], "merged.pdf", { type: "application/pdf" });

        // Clear all old PDF files and add the new merged PDF
        const nonPdfFiles = Array.from(dt.files).filter(file => file.type !== "application/pdf");
        dt.items.clear();
        dt.items.add(mergedFile);
        nonPdfFiles.forEach(file => dt.items.add(file));
        attachmentInput.files = dt.files;

        // Clear and re-add all files including the new merged PDF
        fileListContainer.innerHTML = '';
        Array.from(dt.files).forEach(file => addFileItem(file));
    });
});


    </script>
</body>
</html>